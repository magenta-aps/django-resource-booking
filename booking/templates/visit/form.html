{% extends 'index.html' %}
{% load i18n %}
{% load staticfiles %}
{% load booking_tags %}

{% block head %}
    <link rel="stylesheet" href="{% static 'thirdparty/bootstrap-datetime-picker/css/bootstrap-datetimepicker.min.css' %}"/>
{% endblock %}

{% block content %}
    <div class="divider"></div>
    <div class="row form-group">
        <div class="col-sm-8">
            <h1>{% if object %}{% trans "Rediger tilbud" %}{% else %}{% trans "Nyt tilbud" %}{% endif %}</h1>
        </div>
    <div class="col-sm-4 text-right">
        <a href="#" class="btn btn-default btn-sm openall">Udvid alle felter</a> <a href="#" class="btn btn-default btn-sm closeall">Luk alle felter</a>
    </div>
    </div>
    <hr/>
    <form action="" class="form-horizontal clearfix" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {{ form.non_field_errors }}

        <div class="row form-group">
        <div class="panel-body">
            <div>{{ form.title.errors }}</div>
            <div class="col-sm-2">
            <label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
            </div>
            <div class="col-sm-10">
            {{ form.title }}
            </div>
        </div>
        </div>

        <div id="accordion" class="panel-group" aria-multiselectable="true" role="tablist">
            <div class="panel panel-default">
                <div id="headingDescription" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a aria-controls="collapseDescription" aria-expanded="true" href="#collapseDescription" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Beskrivelse" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseDescription" class="panel-collapse collapse
                {% if not form.errors or form.teaser.errors or form.description.errors or form.price.errors %}in{% endif %}
                " aria-labelledby="headingDescription" role="tabpanel">
                    <div class="panel-body">
                        <div class="row form-group">
                            <div>{{ form.teaser.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.teaser.id_for_label }}">{{ form.teaser.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.teaser }}
                            </div>
                        </div>
                        <div class="row form-group">
                            <div>{{ form.description.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.description.id_for_label }}">{{ form.description.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.description }}
                            </div>
                        </div>
                        <div class="row form-group">
                            <div>{{ form.price.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.price.id_for_label }}">{{ form.price.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.price }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div id="headingCategory" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseCategory" aria-expanded="true" href="#collapseCategory" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Kategorisering" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseCategory" class="panel-collapse collapse
                {% if form.type.errors or form.tags.errors %}in{% endif %}
                " aria-labelledby="headingCategory" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                    <div class="row form-group">
                            <div>{{ form.type.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.type.id_for_label }}">{{ form.type.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.type }}
                            </div>
                        </div>
                        <!-- <div class="row form-group">
                            <div>{{ form.tags.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.tags.id_for_label }}">{{ form.tags.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.tags }}
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div id="headingAudience" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseAudience" aria-expanded="true" href="#collapseAudience" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Målgruppe" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseAudience" class="panel-collapse collapse
                    {% if form.institution_level.errors or form.topics.errors or form.level.errors or form.class_level_min.errors or form.class_level_max.errors or form.minimum_number_of_visitors.errors or form.maximum_number_of_visitors.errors %}in{% endif %}
                    " aria-labelledby="headingAudience" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                        <div class="row form-group">
                            <div>{{ form.institution_level.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.institution_level.id_for_label }}">{{ form.institution_level.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.institution_level }}
                            </div>
                        </div>
                        <!-- <div class="row form-group">
                            <div>{{ form.topics.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.topics.id_for_label }}">{{ form.topics.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.topics }}
                            </div>
                        </div> -->

                        <div class="institution_level_dependent" data-display-value="1">
                            <div class="row form-group">
                                <div>{{ form.level.errors }}</div>
                                <div class="col-sm-2">
                                <label for="{{ form.level.id_for_label }}">{{ form.level.label }}:</label>
                                </div>
                                <div class="col-sm-10">
                                {{ form.level }}
                                </div>
                            </div>
                        </div>
                        <div class="institution_level_dependent" data-display-value="0">
                            <div class="row form-group">
                                <div>{{ form.class_level_min.errors }}</div>
                                <div class="col-sm-2">
                                <label for="{{ form.class_level_min.id_for_label }}">{{ form.class_level_min.label }}:</label>
                                </div>
                                <div class="col-sm-10">
                                {{ form.class_level_min }}
                                </div>
                            </div>
                            <div class="row form-group">
                                <div>{{ form.class_level_max.errors }}</div>
                                <div class="col-sm-2">
                                <label for="{{ form.class_level_max.id_for_label }}">{{ form.class_level_max.label }}:</label>
                                </div>
                                <div class="col-sm-10">
                                {{ form.class_level_max }}
                                </div>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div>{{ form.minimum_number_of_visitors.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.minimum_number_of_visitors.id_for_label }}">{{ form.minimum_number_of_visitors.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.minimum_number_of_visitors }}
                            </div>
                        </div>
                        <div class="row form-group">
                            <div>{{ form.maximum_number_of_visitors.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.maximum_number_of_visitors.id_for_label }}">{{ form.maximum_number_of_visitors.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.maximum_number_of_visitors }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div id="headingTimePlace" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseTimePlace" aria-expanded="true" href="#collapseTimePlace" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Tidspunkt og varighed" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseTimePlace" class="panel-collapse collapse
                {% if form.time.errors or form.duration.errors or form.locality.errors or form.room.errors %}in{% endif %}
                " aria-labelledby="headingTimePlace" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                        <div class="row form-group">
                                    <div>{{ form.time.errors }}</div>
                                    <div class="col-sm-2">
                                    <label for="{{ form.time.id_for_label }}">{{ form.time.label }}:</label>
                                    </div>
                                    <div class="col-sm-10">
                                    {{ form.time }}
                                    </div>
                                    </div>
                                <div class="row form-group">
                                    <div>{{ form.duration.errors }}</div>
                                    <div class="col-sm-2">
                                    <label for="{{ form.duration.id_for_label }}">{{ form.duration.label }}:</label>
                                    </div>
                                    <div class="col-sm-10">
                                    {{ form.duration }}
                                    </div>
                            </div>

                        </div>
                    </div>
                </div>
           

            <div class="panel panel-default">
                <div id="headingRooms" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseRooms" aria-expanded="true" href="#collapseRooms" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Lokalitet og lokaler" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseRooms" class="panel-collapse collapse
                {% if form.rooms_needed.errors or form.rooms_assignment.errors or form.contact_persons.errors %}in{% endif %}
                " aria-labelledby="headingContact" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                        <div class="row form-group">
                                    <div>{{ form.locality.errors }}</div>
                                    <div class="col-sm-2">
                                    <label for="{{ form.locality.id_for_label }}">{{ form.locality.label }}:</label>
                                    </div>
                                    <div class="col-sm-10">
                                    {{ form.locality }}
                                </div>
                            </div>
                        <div class="row form-group">
                            <div>{{ form.rooms_needed.errors }}</div>
                            <div class="col-sm-12">
                            {{ form.rooms_needed }}
                            <label for="{{ form.rooms_needed.id_for_label }}">{{ form.rooms_needed.label }}</label>
                            </div>
                        </div>

                        <div id="rooms_needed_fields">
                        <div class="row form-group">
                            <div>{{ form.rooms_assignment.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.rooms_assignment.id_for_label }}">{{ form.rooms_assignment.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.rooms_assignment }}
                            </div>
                        </div>
                        <div id="roomsedit">
                        <div class="row form-group">
                            <div class="col-sm-2">
                                    <label for="existingrooms">{% trans "Tilføj eksisterende lokale" %}:</label>
                                    </div>
                                    <div class="col-sm-6">
                                    <select name="existingrooms" class="form-control input-sm" id="existingrooms">
                                        <option>{% trans "Vælg lokale..." %}</option>
                                        {% for room in existingrooms %}
                                        <option value="{{room.name}}">{{room.name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                        </div>
                            <div class="row form-group">
                                <div class="col-sm-2">
                                    <label for="newroom">{% trans "Tilføj nyt lokale" %}:</label>
                                    </div>
                                    <div class="col-sm-6">
                                    <div class="input-group">
                                    <input type="text" name="newroom" id="newroom" value="" class="form-control input-sm" /><span class="input-group-btn">
                                    <button type="button" id="addnewroom" value="{% trans "Tilføj" %}" class="btn btn-default">{% trans "Tilføj" %}</button></span>
                                    </div>
                                </div>
                            </div>
                            <div><strong>{% trans "Valgte lokaler" %}:</strong></div>
                            <ul id="chosenrooms">
                            {% comment %}
                                When making changes here, also change the addRoom method
                                in booking/static/js/formutil.js which generates the
                                same HTML dynamically.
                            {% endcomment %}
                            {% for room in rooms %}
                                <li>
                                    <span class="roomname">{{ room.name }}</span>
                                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                    <input type="hidden" name="rooms" value="{{ room.name }}" />
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div id="headingContact" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseContact" aria-expanded="true" href="#collapseContact" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Kontaktinformation" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseContact" class="panel-collapse collapse
                {% if form.enabled.errors or form.contact_persons.errors %}in{% endif %}
                " aria-labelledby="headingContact" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                    <div class="row form-group">
                            <div>{{ form.unit.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.unit.id_for_label }}">{{ form.unit.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.unit }}
                        </div>
                    </div>
                    <div class="row form-group">
                            <div>{{ form.enabled.errors }}</div>
                            <div class="col-sm-12">
                                <label class="radiolabel" for="{{ form.enabled.id_for_label }}">{{ form.enabled }} Kan bookes</label>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div>{{ form.contact_persons.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{ form.contact_persons.id_for_label }}">{{ form.contact_persons.label }}:</label>
                            </div>
                            <div class="col-sm-10">
                            {{ form.contact_persons }}
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="panel panel-default">
                <div id="headingAttach" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseAttach" aria-expanded="true" href="#collapseAttach" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Vedhæftninger" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseAttach" class="panel-collapse collapse" aria-labelledby="headingAttach" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                        <div class="row form-group">
                            <div class="col-sm-2">
                            <label>{% trans "Vedhæftede filer" %}:</label>
                            </div>
                            <div class="col-sm-10">
                            <ul>
                            {% for material in fileformset.studymaterials %}
                                <li>
                                    <a href="{{ MEDIA_URL }}{{ material.file.url }}">{{ material.file.name | upload_name_strip_path }}</a>
                                </li>
                            {% endfor %}
                            </ul>
                            {{ fileformset.management_form }}
                            <div id="attachFileFields">
                            {% for fileform in fileformset %}
                                {{ fileform.file }}
                            {% endfor %}
                            </div>
                            <a id="attachAddFileField">{% trans "Tilføj ny fil" %}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <div class="panel panel-default">
                <div id="headingInternal" class="panel-heading" role="tab">
                    <h4 class="panel-title">
                        <a class="" aria-controls="collapseInternal" aria-expanded="true" href="#collapseInternal" data-parent="#accordion" data-toggle="collapse" role="button">{% trans "Interne oplysninger" %}</a><span class="caret"></span>
                    </h4>
                </div>
                <div id="collapseInternal" class="panel-collapse collapse {% if form.enabled.errors or form.contact_persons.errors %}in{% endif %} " aria-labelledby="headingContact" role="tabpanel" aria-expanded="true" style="">
                    <div class="panel-body">
                        <div class="row form-group">  
                            <div>{{ form.preparation_time.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{
                                form.preparation_time.id_for_label }}">{{ form.preparation_time.label }}:</label>
                                </div>
                                <div class="col-sm-2">
                            {{ form.preparation_time }}
                        </div>
                        </div>
                        <div class="row form-group">  
                            <div>{{ form.comment.errors }}</div>
                            <div class="col-sm-2">
                            <label for="{{
                                form.comment.id_for_label }}">{{ form.comment.label }}:</label>
                                </div>
                                <div class="col-sm-10">
                            {{ form.comment }}
                        </div>
                        </div>
                    </div>
                </div>
            </div>
</div>
        {% include 'common/save_cancel.html' %}
        <div class="divider"></div>
    </form>

{% endblock %}

{% block extra_scripts %}
    
    {{ form.media }}
    <script type="text/javascript" src="{% static 'thirdparty/bootstrap-datetime-picker/js/bootstrap-datetimepicker.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/formutil.js' %}"></script>
    <script type="text/javascript"><!--
        $(function(){
            var totalFormsField = $("#{{ fileformset.management_form.TOTAL_FORMS.id_for_label }}"),
                maxForms = parseInt($("#{{ fileformset.management_form.MAX_NUM_FORMS.id_for_label }}").val()) || 1000,
                fieldContainer = $("#attachFileFields"),
                numberFinder = /\d+/;

            $("#attachAddFileField").click(function(){
                if (fieldContainer.find("input[type=file]").length < maxForms) {
                    var newFileField = fieldContainer.find("input[type=file]").last().clone();
                    var match = numberFinder.exec(newFileField.attr("id"));
                    if (match) {
                        var number = parseInt(match[0], 10) + 1;
                        newFileField.attr("id", newFileField.attr("id").replace(numberFinder, number));
                        newFileField.attr("name", newFileField.attr("name").replace(numberFinder, number));
                        newFileField.val(null);
                        fieldContainer.append(newFileField);
                        totalFormsField.val(fieldContainer.find("input[type=file]").length);
                    }
                }
            });
        });

        $(function(){
            // See doc at http://www.malot.fr/bootstrap-datetimepicker/
            $("#{{ form.time.id_for_label }}").datetimepicker({
                locale: 'da',
                autoclose: true
            });
        });

        $(function(){
            var select = $("#{{ form.institution_level.id_for_label }}");
            var changeDisplay = function(){
                var value = select.val();
                $(".institution_level_dependent[data-display-value='"+value+"']").show();
                $(".institution_level_dependent[data-display-value!='"+value+"']").hide();
            };
            select.change(changeDisplay);
            changeDisplay();
            // Toggle arrows
            $('.collapse').on('show.bs.collapse', function() {
            $(this).prev().find(".caret").addClass("caret-up");
            });
            $('.collapse').on('hide.bs.collapse', function() {
                $(this).prev().find(".caret").removeClass("caret-up");
            });
            $('.closeall').click(function(){
              $('.panel-collapse.in').collapse('hide');
            });
            $('.openall').click(function(){
              $('.panel-collapse:not(".in")').collapse('show');
            });
        });
    //--></script>
    
{% endblock %}
